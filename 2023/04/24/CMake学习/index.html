<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>CMake学习 - MK&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="MK&#039;s Blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="MK&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content=""><meta property="og:type" content="blog"><meta property="og:title" content="CMake学习"><meta property="og:url" content="http://mkmq99.github.io/2023/04/24/CMake%E5%AD%A6%E4%B9%A0/"><meta property="og:site_name" content="MK&#039;s Blog"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://mkmq99.github.io/2023/04/24/CMake%E5%AD%A6%E4%B9%A0/0.png"><meta property="article:published_time" content="2023-04-24T06:20:01.000Z"><meta property="article:modified_time" content="2023-04-24T09:28:52.409Z"><meta property="article:author" content="MK"><meta property="article:tag" content="C++ Tools"><meta property="article:tag" content="CMake"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://mkmq99.github.io/2023/04/24/CMake%E5%AD%A6%E4%B9%A0/0.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://mkmq99.github.io/2023/04/24/CMake%E5%AD%A6%E4%B9%A0/"},"headline":"CMake学习","image":["http://mkmq99.github.io/2023/04/24/CMake%E5%AD%A6%E4%B9%A0/0.png"],"datePublished":"2023-04-24T06:20:01.000Z","dateModified":"2023-04-24T09:28:52.409Z","author":{"@type":"Person","name":"MK"},"publisher":{"@type":"Organization","name":"MK's Blog","logo":{"@type":"ImageObject","url":{"text":"MK's Blog"}}},"description":""}</script><link rel="canonical" href="http://mkmq99.github.io/2023/04/24/CMake%E5%AD%A6%E4%B9%A0/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">MK&#039;s Blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-04-24T06:20:01.000Z" title="2023/4/24 14:20:01">2023-04-24</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-04-24T09:28:52.409Z" title="2023/4/24 17:28:52">2023-04-24</time></span><span class="level-item"><a class="link-muted" href="/categories/C-Tools/">C++ Tools</a></span><span class="level-item">23 minutes read (About 3402 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">CMake学习</h1><div class="content"><p><img src="/2023/04/24/CMake%E5%AD%A6%E4%B9%A0/0.png"></p>
<span id="more"></span>

<h3 id="1-什么是CMake？"><a href="#1-什么是CMake？" class="headerlink" title="1 什么是CMake？"></a>1 什么是CMake？</h3><p>CMake是一个<strong>跨平台</strong>的编译(Build)工具,可以用简单的语句来描述所有平台的编译过程。简单来说，CMake可以<strong>跨平台</strong>生成对应平台能用的makefile。</p>
<h3 id="2-CMake一个HelloWorld"><a href="#2-CMake一个HelloWorld" class="headerlink" title="2 CMake一个HelloWorld"></a>2 CMake一个HelloWorld</h3><ol>
<li>写一个HelloWorld</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;HelloWorld!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>写CMakeLists.txt</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PROJECT</span> (HELLO)</span><br><span class="line"></span><br><span class="line"><span class="built_in">SET</span>(SRC_LIST main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="built_in">MESSAGE</span>(STATUS <span class="string">&quot;This is BINARY dir &quot;</span> $&#123;HELLO_BINARY_DIR&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">MESSAGE</span>(STATUS <span class="string">&quot;This is SOURCE dir &quot;</span>$&#123;HELLO_SOURCE_DIR&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">ADD_EXECUTABLE</span>(hello $&#123;SRC_LIST&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用cmake，生成makefile文件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">sq@ubuntu:~/Desktop/cmake_study/cmake01$ cmake .</span><br><span class="line">CMake Warning (dev) at CMakeLists.txt:7:</span><br><span class="line">  Syntax Warning <span class="keyword">in</span> cmake code at column 37</span><br><span class="line"></span><br><span class="line">  Argument not separated from preceding token by whitespace.</span><br><span class="line">This warning is <span class="keyword">for</span> project developers.  Use -Wno-dev to suppress it.</span><br><span class="line"></span><br><span class="line">-- The C compiler identification is GNU 9.4.0</span><br><span class="line">-- The CXX compiler identification is GNU 9.4.0</span><br><span class="line">-- Check <span class="keyword">for</span> working C compiler: /usr/bin/cc</span><br><span class="line">-- Check <span class="keyword">for</span> working C compiler: /usr/bin/cc -- works</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - <span class="keyword">done</span></span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - <span class="keyword">done</span></span><br><span class="line">-- Check <span class="keyword">for</span> working CXX compiler: /usr/bin/c++</span><br><span class="line">-- Check <span class="keyword">for</span> working CXX compiler: /usr/bin/c++ -- works</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - <span class="keyword">done</span></span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - <span class="keyword">done</span></span><br><span class="line">-- This is BINARY <span class="built_in">dir</span> /home/sq/Desktop/cmake_study/cmake01</span><br><span class="line">-- This is SOURCE <span class="built_in">dir</span> /home/sq/Desktop/cmake_study/cmake01</span><br><span class="line">-- Configuring <span class="keyword">done</span></span><br><span class="line">-- Generating <span class="keyword">done</span></span><br><span class="line">-- Build files have been written to: /home/sq/Desktop/cmake_study/cmake01</span><br></pre></td></tr></table></figure>

<p>目录下就生成了这些文件：CMakeFiles, CMakeCache.txt, cmake_install.cmake 等文件，并且生成了Makefile。</p>
<ol start="4">
<li>使用make命令编译</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sq@ubuntu:~/Desktop/cmake_study/cmake01$ make</span><br><span class="line">Scanning dependencies of target hello</span><br><span class="line">[ 50%] Building CXX object CMakeFiles/hello.dir/main.cpp.o</span><br><span class="line">[100%] Linking CXX executable hello</span><br><span class="line">[100%] Built target hello</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>最终生成了Hello的可执行程序</li>
</ol>
<h3 id="3-CMake一个HelloWord的语法介绍"><a href="#3-CMake一个HelloWord的语法介绍" class="headerlink" title="3 CMake一个HelloWord的语法介绍"></a>3 CMake一个HelloWord的语法介绍</h3><h4 id="3-1-PROJECT关键字"><a href="#3-1-PROJECT关键字" class="headerlink" title="3.1 PROJECT关键字"></a>3.1 PROJECT关键字</h4><p>可以用来指定工程的名字和支持的语言，默认支持所有语言</p>
<p>PROJECT (HELLO)   指定了工程的名字，并且支持所有语言—建议</p>
<p>PROJECT (HELLO CXX)      指定了工程的名字，并且支持语言是C++</p>
<p>PROJECT (HELLO C CXX)      指定了工程的名字，并且支持语言是C和C++</p>
<p>该指定隐式定义了两个CMAKE的变量</p>
<p>&lt;projectname&gt;_BINARY_DIR，本例中是 HELLO_BINARY_DIR</p>
<p>&lt;projectname&gt;_SOURCE_DIR，本例中是 HELLO_SOURCE_DIR</p>
<p>MESSAGE关键字就可以直接使用者两个变量，当前都指向当前的工作目录，后面会讲外部编译</p>
<p><strong>问题：如果改了工程名，这两个变量名也会改变</strong></p>
<p>解决：又定义两个预定义变量：PROJECT_BINARY_DIR和PROJECT_SOURCE_DIR，这两个变量和HELLO_BINARY_DIR，HELLO_SOURCE_DIR是一致的。所以改了工程名也没有关系</p>
<h4 id="3-2-SET关键字"><a href="#3-2-SET关键字" class="headerlink" title="3.2 SET关键字"></a>3.2 SET关键字</h4><p>用来显示的指定变量的</p>
<p>SET(SRC_LIST main.cpp)    SRC_LIST变量就包含了main.cpp</p>
<p>也可以 SET(SRC_LIST main.cpp t1.cpp t2.cpp)</p>
<h4 id="3-3-MESSAGE关键字"><a href="#3-3-MESSAGE关键字" class="headerlink" title="3.3 MESSAGE关键字"></a>3.3 MESSAGE关键字</h4><p>向终端输出用户自定义的信息</p>
<p>主要包含三种信息：</p>
<ul>
<li>SEND_ERROR，产生错误，生成过程被跳过。</li>
<li>SATUS，输出前缀为 “–” 的信息。</li>
<li>FATAL_ERROR，立即终止所有 cmake 过程.</li>
</ul>
<h4 id="3-4-ADD-EXECUTABLE关键字"><a href="#3-4-ADD-EXECUTABLE关键字" class="headerlink" title="3.4 ADD_EXECUTABLE关键字"></a>3.4 ADD_EXECUTABLE关键字</h4><p>生成可执行文件</p>
<p>ADD_EXECUTABLE(hello ${SRC_LIST})     生成的可执行文件名是hello，源文件读取变量SRC_LIST中的内容</p>
<p>也可以直接写 ADD_EXECUTABLE(hello main.cpp)</p>
<p>上述例子可以简化的写成</p>
<p>PROJECT(HELLO)<br>ADD_EXECUTABLE(hello main.cpp)</p>
<p><strong>注意：工程名的 HELLO 和生成的可执行文件 hello 是没有任何关系的</strong></p>
<h3 id="4-语法的基本原则"><a href="#4-语法的基本原则" class="headerlink" title="4 语法的基本原则"></a>4 语法的基本原则</h3><ul>
<li><p>变量使用${}方式取值，但是在 IF 控制语句中是直接使用变量名</p>
</li>
<li><p>指令(参数 1 参数 2…) 参数使用括弧括起，参数之间使用空格或分号分开。 以上面的 ADD_EXECUTABLE 指令为例，如果存在另外一个 func.cpp 源文件</p>
<p>就要写成：ADD_EXECUTABLE(hello main.cpp func.cpp)或者ADD_EXECUTABLE(hello main.cpp;func.cpp)</p>
</li>
<li><p>指令是大小写无关的，参数和变量是大小写相关的。但，推荐你全部使用大写指令</p>
</li>
</ul>
<p><strong>语法注意事项</strong></p>
<ul>
<li>SET(SRC_LIST main.cpp) 可以写成 SET(SRC_LIST “main.cpp”)，如果源文件名中含有空格，就必须要加双引号</li>
<li>ADD_EXECUTABLE(hello main) 后缀可以不行，他会自动去找.c和.cpp，最好不要这样写，可能会有这两个文件main.cpp和main</li>
</ul>
<h3 id="5-内部构建和外部构建"><a href="#5-内部构建和外部构建" class="headerlink" title="5 内部构建和外部构建"></a>5 内部构建和外部构建</h3><ul>
<li>上述例子就是内部构建，他生产的临时文件特别多，不方便清理</li>
<li>外部构建，就会把生成的临时文件放在build目录下，不会对源文件有任何影响强烈使用外部构建方式</li>
</ul>
<p><strong>外部构建方式举例</strong></p>
<ol>
<li><p>建立一个build目录，可以在任何地方，建议在当前目录下</p>
</li>
<li><p>进入build，运行cmake ..    当然..表示上一级目录，你可以写CMakeLists.txt所在的绝对路径，生产的文件都在build目录下了</p>
</li>
<li><p>在build目录下，运行make来构建工程</p>
</li>
</ol>
<p>注意外部构建的两个变量</p>
<p>1、HELLO_SOURCE_DIR  还是工程路径，也就是 &#x2F;home&#x2F;sq&#x2F;Desktop&#x2F;cmake_study&#x2F;cmake01</p>
<p>2、HELLO_BINARY_DIR   编译路径，也就是 &#x2F;home&#x2F;sq&#x2F;Desktop&#x2F;cmake_study&#x2F;cmake01&#x2F;build</p>
<h3 id="6-让HelloWorld看起来更像一个工程"><a href="#6-让HelloWorld看起来更像一个工程" class="headerlink" title="6 让HelloWorld看起来更像一个工程"></a>6 让HelloWorld看起来更像一个工程</h3><ul>
<li>为工程添加一个子目录 src，用来放置工程源代码</li>
<li>添加一个子目录 doc，用来放置这个工程的文档 hello.txt</li>
<li>在工程目录添加文本文件 COPYRIGHT, README</li>
<li>在工程目录添加一个 <a target="_blank" rel="noopener" href="http://runhello.sh/">runhello.sh</a> 脚本，用来调用 hello 二进制</li>
<li>将构建后的目标文件放入构建目录的 bin 子目录</li>
<li>将 doc 目录的内容以及 COPYRIGHT&#x2F;README 安装到&#x2F;usr&#x2F;share&#x2F;doc&#x2F;cmake&#x2F;</li>
</ul>
<h4 id="6-1-将目标文件放入构建目录的-bin-子目录"><a href="#6-1-将目标文件放入构建目录的-bin-子目录" class="headerlink" title="6.1 将目标文件放入构建目录的 bin 子目录"></a>6.1 将目标文件放入构建目录的 bin 子目录</h4><p>每个目录下都要有一个CMakeLists.txt说明</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost cmake]<span class="comment"># tree</span></span><br><span class="line">.</span><br><span class="line">├── build</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">└── src</span><br><span class="line">    ├── CMakeLists.txt</span><br><span class="line">    └── main.cpp</span><br></pre></td></tr></table></figure>

<p>外层CMakeLists.txt</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PROJECT</span>(HELLO)</span><br><span class="line"><span class="keyword">ADD_SUBDIRECTORY</span>(src bin)</span><br></pre></td></tr></table></figure>

<p>src下的CMakeLists.txt</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD_EXECUTABLE</span>(hello main.cpp)</span><br></pre></td></tr></table></figure>

<h5 id="6-1-1-ADD-SUBDIRECTORY-指令"><a href="#6-1-1-ADD-SUBDIRECTORY-指令" class="headerlink" title="6.1.1 ADD_SUBDIRECTORY 指令"></a>6.1.1 ADD_SUBDIRECTORY 指令</h5><p>ADD_SUBDIRECTORY(source_dir [binary_dir] [EXCLUDE_FROM_ALL])</p>
<ul>
<li><p>这个指令用于向当前工程添加存放源文件的子目录，并可以指定中间二进制和目标二进制存放的位置</p>
</li>
<li><p>EXCLUDE_FROM_ALL函数是将写的目录从编译中排除，如程序中的example</p>
</li>
<li><p>ADD_SUBDIRECTORY(src bin)</p>
<p>将 src 子目录加入工程并指定编译输出(包含编译中间结果)路径为bin 目录</p>
<p>如果不进行 bin 目录的指定，那么编译结果(包括中间结果)都将存放在build&#x2F;src 目录</p>
</li>
</ul>
<h5 id="6-1-2-更改二进制的保存路径"><a href="#6-1-2-更改二进制的保存路径" class="headerlink" title="6.1.2 更改二进制的保存路径"></a>6.1.2 更改二进制的保存路径</h5><p>SET 指令重新定义 EXECUTABLE_OUTPUT_PATH 和 LIBRARY_OUTPUT_PATH 变量来指定最终的目标二进制的位置</p>
<p>SET(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}&#x2F;bin)<br>SET(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}&#x2F;lib)</p>
<p>思考：加载哪个CMakeLists.txt当中</p>
<p>哪里要改变目标存放路径，就在哪里加入上述的定义，所以应该在src下的CMakeLists.txt下写</p>
<h3 id="7-安装"><a href="#7-安装" class="headerlink" title="7 安装"></a>7 安装</h3><ul>
<li>一种是从代码编译后直接 make install 安装</li>
<li>一种是打包时的指定目录安装。<ul>
<li>简单的可以这样指定目录：make install DESTDIR&#x3D;&#x2F;tmp&#x2F;test</li>
<li>稍微复杂一点可以这样指定目录：.&#x2F;configure –prefix&#x3D;&#x2F;usr</li>
</ul>
</li>
</ul>
<h4 id="7-1-如何安装HelloWord"><a href="#7-1-如何安装HelloWord" class="headerlink" title="7.1 如何安装HelloWord"></a>7.1 如何安装HelloWord</h4><p>使用CMAKE一个新的指令：INSTALL</p>
<p>INSTALL的安装可以包括：二进制、动态库、静态库以及文件、目录、脚本等</p>
<p>使用CMAKE一个新的变量：CMAKE_INSTALL_PREFIX</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 目录树结构</span><br><span class="line">[root@localhost cmake]<span class="comment"># tree</span></span><br><span class="line">.</span><br><span class="line">├── build</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">├── COPYRIGHT</span><br><span class="line">├── doc</span><br><span class="line">│   └── hello.txt</span><br><span class="line">├── README</span><br><span class="line">├── runhello.sh</span><br><span class="line">└── src</span><br><span class="line">    ├── CMakeLists.txt</span><br><span class="line">    └── main.cpp</span><br><span class="line"></span><br><span class="line">3 directories, 7 files</span><br></pre></td></tr></table></figure>

<h4 id="7-2-安装文件COPYRIGHT和README"><a href="#7-2-安装文件COPYRIGHT和README" class="headerlink" title="7.2 安装文件COPYRIGHT和README"></a>7.2 安装文件COPYRIGHT和README</h4><p>INSTALL(FILES COPYRIGHT README DESTINATION share&#x2F;doc&#x2F;cmake&#x2F;)</p>
<p><strong>FILES：</strong>文件</p>
<p><strong>DESTINATION：</strong></p>
<ol>
<li><p>写绝对路径</p>
</li>
<li><p>可以写相对路径，相对路径实际路径是：${CMAKE_INSTALL_PREFIX}&#x2F;&lt;DESTINATION 定义的路径&gt;</p>
</li>
</ol>
<p>​		CMAKE_INSTALL_PREFIX  默认是在 &#x2F;usr&#x2F;local&#x2F;</p>
<p>​		cmake -DCMAKE_INSTALL_PREFIX&#x3D;&#x2F;usr    在cmake的时候指定CMAKE_INSTALL_PREFIX变量的路径</p>
<h4 id="7-3-安装脚本runhello-sh"><a href="#7-3-安装脚本runhello-sh" class="headerlink" title="7.3 安装脚本runhello.sh"></a>7.3 安装脚本runhello.sh</h4><p>PROGRAMS：非目标文件的可执行程序安装(比如脚本之类)</p>
<p>INSTALL(PROGRAMS runhello.sh DESTINATION bin)</p>
<p>说明：实际安装到的是 &#x2F;usr&#x2F;bin</p>
<h4 id="7-4-安装-doc-中的-hello-txt"><a href="#7-4-安装-doc-中的-hello-txt" class="headerlink" title="7.4 安装 doc 中的 hello.txt"></a>7.4 安装 doc 中的 hello.txt</h4><ul>
<li><p>一、是通过在 doc 目录建立CMakeLists.txt ，通过install下的file</p>
</li>
<li><p>二、是直接在工程目录通过</p>
<p>INSTALL(DIRECTORY doc&#x2F; DESTINATION share&#x2F;doc&#x2F;cmake)</p>
</li>
</ul>
<p>DIRECTORY 后面连接的是所在 Source 目录的相对路径</p>
<p>注意：abc 和 abc&#x2F;有很大的区别</p>
<p>目录名不以&#x2F;结尾：这个目录将被安装为目标路径下的</p>
<p>目录名以&#x2F;结尾：将这个目录中的内容安装到目标路径</p>
<h4 id="7-5-安装过程"><a href="#7-5-安装过程" class="headerlink" title="7.5 安装过程"></a>7.5 安装过程</h4><p>cmake ..</p>
<p>make</p>
<p>make install</p>
<h3 id="8-静态库和动态库的构建"><a href="#8-静态库和动态库的构建" class="headerlink" title="8 静态库和动态库的构建"></a>8 静态库和动态库的构建</h3><p>任务：</p>
<ol>
<li><p>建立一个静态库和动态库，提供 HelloFunc 函数供其他程序编程使用，HelloFunc 向终端输出 Hello World 字符串。 </p>
</li>
<li><p>安装头文件与共享库。</p>
</li>
</ol>
<p>静态库和动态库的区别</p>
<ul>
<li>静态库的扩展名一般为“.a”或“.lib”；动态库的扩展名一般为“.so”或“.dll”。</li>
<li>静态库在编译时会直接整合到目标程序中，编译成功的可执行文件可独立运行</li>
<li>动态库在编译时不会放到连接的目标程序中，即可执行文件无法单独运行。</li>
</ul>
<h4 id="8-1-构建实例"><a href="#8-1-构建实例" class="headerlink" title="8.1 构建实例"></a>8.1 构建实例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost cmake2]<span class="comment"># tree</span></span><br><span class="line">.</span><br><span class="line">├── build</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">└── lib</span><br><span class="line">    ├── CMakeLists.txt</span><br><span class="line">    ├── hello.cpp</span><br><span class="line">    └── hello.h</span><br></pre></td></tr></table></figure>

<p>hello.h中的内容</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> HELLO_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Hello_H</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">HelloFunc</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>hello.cpp中的内容</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hello.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">HelloFunc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello World&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>项目中的cmake内容</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PROJECT</span>(HELLO)</span><br><span class="line"><span class="keyword">ADD_SUBDIRECTORY</span>(lib bin)</span><br></pre></td></tr></table></figure>

<p>lib中CMakeLists.txt中的内容</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span>(LIBHELLO_SRC hello.cpp)</span><br><span class="line"><span class="keyword">ADD_LIBRARY</span>(hello SHARED <span class="variable">$&#123;LIBHELLO_SRC&#125;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="8-1-1-ADD-LIBRARY"><a href="#8-1-1-ADD-LIBRARY" class="headerlink" title="8.1.1 ADD_LIBRARY"></a>8.1.1 ADD_LIBRARY</h5><p>ADD_LIBRARY(hello SHARED ${LIBHELLO_SRC})</p>
<ul>
<li>hello：就是正常的库名，生成的名字前面会加上lib，最终产生的文件是libhello.so</li>
<li>SHARED，动态库    STATIC，静态库</li>
<li>${LIBHELLO_SRC} ：源文件</li>
</ul>
<h4 id="8-2-同时构建静态和动态库"><a href="#8-2-同时构建静态和动态库" class="headerlink" title="8.2 同时构建静态和动态库"></a>8.2 同时构建静态和动态库</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 如果用这种方式，只会构建一个动态库，不会构建出静态库，虽然静态库的后缀是.a</span><br><span class="line"><span class="keyword">ADD_LIBRARY</span>(hello SHARED <span class="variable">$&#123;LIBHELLO_SRC&#125;</span>)</span><br><span class="line"><span class="keyword">ADD_LIBRARY</span>(hello STATIC <span class="variable">$&#123;LIBHELLO_SRC&#125;</span>)</span><br><span class="line"></span><br><span class="line">// 修改静态库的名字，这样是可以的，但是我们往往希望他们的名字是相同的，只是后缀不同而已</span><br><span class="line"><span class="keyword">ADD_LIBRARY</span>(hello SHARED <span class="variable">$&#123;LIBHELLO_SRC&#125;</span>)</span><br><span class="line"><span class="keyword">ADD_LIBRARY</span>(hello_static STATIC <span class="variable">$&#123;LIBHELLO_SRC&#125;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="8-2-1-SET-TARGET-PROPERTIES"><a href="#8-2-1-SET-TARGET-PROPERTIES" class="headerlink" title="8.2.1 SET_TARGET_PROPERTIES"></a>8.2.1 SET_TARGET_PROPERTIES</h5><p>这条指令可以用来设置输出的名称，对于动态库，还可以用来指定动态库版本和 API 版本</p>
<p>同时构建静态和动态库</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span>(LIBHELLO_SRC hello.cpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD_LIBRARY</span>(hello_static STATIC <span class="variable">$&#123;LIBHELLO_SRC&#125;</span>)</span><br><span class="line">//对hello_static的重名为hello</span><br><span class="line"><span class="keyword">SET_TARGET_PROPERTIES</span>(hello_static PROPERTIES  OUTPUT_NAME <span class="string">&quot;hello&quot;</span>)</span><br><span class="line">//cmake 在构建一个新的<span class="keyword">target</span> 时，会尝试清理掉其他使用这个名字的库，因为，在构建 libhello.so 时， 就会清理掉 libhello.a</span><br><span class="line"><span class="keyword">SET_TARGET_PROPERTIES</span>(hello_static PROPERTIES CLEAN_DIRECT_OUTPUT <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD_LIBRARY</span>(hello SHARED <span class="variable">$&#123;LIBHELLO_SRC&#125;</span>)</span><br><span class="line"><span class="keyword">SET_TARGET_PROPERTIES</span>(hello PROPERTIES  OUTPUT_NAME <span class="string">&quot;hello&quot;</span>)</span><br><span class="line"><span class="keyword">SET_TARGET_PROPERTIES</span>(hello PROPERTIES CLEAN_DIRECT_OUTPUT <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>CLEAN_DIRECT_OUTPUT新版本已经不需要了，直接重命名即可</p>
<h4 id="8-3-动态库的版本号"><a href="#8-3-动态库的版本号" class="headerlink" title="8.3 动态库的版本号"></a>8.3 动态库的版本号</h4><p>一般动态库都有一个版本号的关联</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">libhello.so<span class="number">.1</span><span class="number">.2</span><span class="number">.3</span></span><br><span class="line">libhello.so -&gt;libhello.so<span class="number">.1</span></span><br><span class="line">libhello.so<span class="number">.1</span>-&gt;libhello.so<span class="number">.1</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>

<p>CMakeLists.txt 插入如下</p>
<p><code>SET_TARGET_PROPERTIES(hello PROPERTIES VERSION 1.2 SOVERSION 1)</code></p>
<p>VERSION 指代动态库版本（一般来说格式为：主版本号.次版本号.发布版本号），SOVERSION 指代主版本号。</p>
<h4 id="8-4-安装共享库和头文件"><a href="#8-4-安装共享库和头文件" class="headerlink" title="8.4 安装共享库和头文件"></a>8.4 安装共享库和头文件</h4><p>本例中我们将 hello 的共享库安装到&lt;prefix&gt;&#x2F;lib目录，</p>
<p>将 hello.h 安装到&lt;prefix&gt;&#x2F;include&#x2F;hello 目录</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//文件放到该目录下</span></span><br><span class="line"><span class="built_in">INSTALL</span>(FILES hello.h DESTINATION include/hello)</span><br><span class="line"></span><br><span class="line"><span class="comment">//二进制，静态库，动态库安装都用TARGETS</span></span><br><span class="line"><span class="comment">//ARCHIVE 特指静态库，LIBRARY 特指动态库，RUNTIME 特指可执行目标二进制。</span></span><br><span class="line"><span class="built_in">INSTALL</span>(TARGETS hello hello_static LIBRARY DESTINATION lib ARCHIVE DESTINATION lib)</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<p>安装的时候，指定一下路径，放到系统下</p>
<p><code>cmake -DCMAKE_INSTALL_PREFIX=/usr ..</code></p>
<h4 id="8-5-解决：make后头文件找不到的问题"><a href="#8-5-解决：make后头文件找不到的问题" class="headerlink" title="8.5 解决：make后头文件找不到的问题"></a>8.5 解决：make后头文件找不到的问题</h4><p>PS：include &lt;hello&#x2F;hello.h&gt;  这样include是可以，这么做的话，就没啥好讲的了</p>
<p>关键字：INCLUDE_DIRECTORIES    这条指令可以用来向工程添加多个特定的头文件搜索路径，路径之间用空格分割</p>
<p>在CMakeLists.txt中加入头文件搜索路径</p>
<p>INCLUDE_DIRECTORIES(&#x2F;usr&#x2F;include&#x2F;hello)</p>
<h4 id="8-6-解决：找到引用的函数问题"><a href="#8-6-解决：找到引用的函数问题" class="headerlink" title="8.6 解决：找到引用的函数问题"></a>8.6 解决：找到引用的函数问题</h4><p>报错信息：undefined reference to &#96;HelloFunc()’</p>
<p>方法一：</p>
<p>关键字：LINK_DIRECTORIES     添加非标准的共享库搜索路径</p>
<p>指定第三方库所在路径，LINK_DIRECTORIES(&#x2F;home&#x2F;myproject&#x2F;libs)</p>
<p>方法二：</p>
<p>关键字：TARGET_LINK_LIBRARIES    添加需要链接的共享库</p>
<p>TARGET_LINK_LIBRARIES的时候，只需要给出动态链接库的名字就行了。</p>
<p>在CMakeLists.txt中插入链接共享库，主要要插在executable的后面</p>
<p>链接静态库 <code>TARGET_LINK_LIBRARIES(main libhello.a)</code></p>
<h4 id="8-7-特殊的环境变量-CMAKE-INCLUDE-PATH-和-CMAKE-LIBRARY-PATH"><a href="#8-7-特殊的环境变量-CMAKE-INCLUDE-PATH-和-CMAKE-LIBRARY-PATH" class="headerlink" title="8.7 特殊的环境变量 CMAKE_INCLUDE_PATH 和 CMAKE_LIBRARY_PATH"></a>8.7 特殊的环境变量 CMAKE_INCLUDE_PATH 和 CMAKE_LIBRARY_PATH</h4><p>注意：这两个是环境变量而不是 cmake 变量，可以在linux的bash中进行设置</p>
<p>我们上面例子中使用了绝对路径INCLUDE_DIRECTORIES(&#x2F;usr&#x2F;include&#x2F;hello)来指明include路径的位置</p>
<p>我们还可以使用另外一种方式，使用环境变量export CMAKE_INCLUDE_PATH&#x3D;&#x2F;usr&#x2F;include&#x2F;hello</p>
<p>补充：生产debug版本的方法：<br>cmake .. -DCMAKE_BUILD_TYPE&#x3D;debug</p>
<blockquote>
<p>学习自：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1vR4y1u77h/?spm_id_from=333.337.search-card.all.click&vd_source=ef25d5afd1228b266bdce5d8346775b7">从零开始详细介绍CMake_哔哩哔哩_bilibili</a></p>
</blockquote>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/C-Tools/">C++ Tools</a><a class="link-muted mr-2" rel="tag" href="/tags/CMake/">CMake</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2023/04/25/%E7%BC%96%E8%AF%91%E4%B8%8E%E7%BC%96%E8%AF%91%E5%99%A8/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">编译与编译器</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/04/22/myMuduo%E5%9B%9E%E9%A1%BE%E4%BA%8C%EF%BC%9A%E5%85%B6%E4%BB%96%E9%83%A8%E5%88%86/"><span class="level-item">myMuduo回顾二：其他部分</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="MK"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">MK</p><p class="is-size-6 is-block">MKMQ99</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Shanghai</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">14</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">24</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/MKMQ99" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/MKMQ99"><i class="fab fa-github"></i></a></div></div></div><div class="card widget is-sticky" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#1-什么是CMake？"><span class="level-left"><span class="level-item">1</span><span class="level-item">1 什么是CMake？</span></span></a></li><li><a class="level is-mobile" href="#2-CMake一个HelloWorld"><span class="level-left"><span class="level-item">2</span><span class="level-item">2 CMake一个HelloWorld</span></span></a></li><li><a class="level is-mobile" href="#3-CMake一个HelloWord的语法介绍"><span class="level-left"><span class="level-item">3</span><span class="level-item">3 CMake一个HelloWord的语法介绍</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#3-1-PROJECT关键字"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">3.1 PROJECT关键字</span></span></a></li><li><a class="level is-mobile" href="#3-2-SET关键字"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">3.2 SET关键字</span></span></a></li><li><a class="level is-mobile" href="#3-3-MESSAGE关键字"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">3.3 MESSAGE关键字</span></span></a></li><li><a class="level is-mobile" href="#3-4-ADD-EXECUTABLE关键字"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">3.4 ADD_EXECUTABLE关键字</span></span></a></li></ul></li><li><a class="level is-mobile" href="#4-语法的基本原则"><span class="level-left"><span class="level-item">4</span><span class="level-item">4 语法的基本原则</span></span></a></li><li><a class="level is-mobile" href="#5-内部构建和外部构建"><span class="level-left"><span class="level-item">5</span><span class="level-item">5 内部构建和外部构建</span></span></a></li><li><a class="level is-mobile" href="#6-让HelloWorld看起来更像一个工程"><span class="level-left"><span class="level-item">6</span><span class="level-item">6 让HelloWorld看起来更像一个工程</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#6-1-将目标文件放入构建目录的-bin-子目录"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">6.1 将目标文件放入构建目录的 bin 子目录</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#6-1-1-ADD-SUBDIRECTORY-指令"><span class="level-left"><span class="level-item">6.1.1</span><span class="level-item">6.1.1 ADD_SUBDIRECTORY 指令</span></span></a></li><li><a class="level is-mobile" href="#6-1-2-更改二进制的保存路径"><span class="level-left"><span class="level-item">6.1.2</span><span class="level-item">6.1.2 更改二进制的保存路径</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#7-安装"><span class="level-left"><span class="level-item">7</span><span class="level-item">7 安装</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#7-1-如何安装HelloWord"><span class="level-left"><span class="level-item">7.1</span><span class="level-item">7.1 如何安装HelloWord</span></span></a></li><li><a class="level is-mobile" href="#7-2-安装文件COPYRIGHT和README"><span class="level-left"><span class="level-item">7.2</span><span class="level-item">7.2 安装文件COPYRIGHT和README</span></span></a></li><li><a class="level is-mobile" href="#7-3-安装脚本runhello-sh"><span class="level-left"><span class="level-item">7.3</span><span class="level-item">7.3 安装脚本runhello.sh</span></span></a></li><li><a class="level is-mobile" href="#7-4-安装-doc-中的-hello-txt"><span class="level-left"><span class="level-item">7.4</span><span class="level-item">7.4 安装 doc 中的 hello.txt</span></span></a></li><li><a class="level is-mobile" href="#7-5-安装过程"><span class="level-left"><span class="level-item">7.5</span><span class="level-item">7.5 安装过程</span></span></a></li></ul></li><li><a class="level is-mobile" href="#8-静态库和动态库的构建"><span class="level-left"><span class="level-item">8</span><span class="level-item">8 静态库和动态库的构建</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#8-1-构建实例"><span class="level-left"><span class="level-item">8.1</span><span class="level-item">8.1 构建实例</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#8-1-1-ADD-LIBRARY"><span class="level-left"><span class="level-item">8.1.1</span><span class="level-item">8.1.1 ADD_LIBRARY</span></span></a></li></ul></li><li><a class="level is-mobile" href="#8-2-同时构建静态和动态库"><span class="level-left"><span class="level-item">8.2</span><span class="level-item">8.2 同时构建静态和动态库</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#8-2-1-SET-TARGET-PROPERTIES"><span class="level-left"><span class="level-item">8.2.1</span><span class="level-item">8.2.1 SET_TARGET_PROPERTIES</span></span></a></li></ul></li><li><a class="level is-mobile" href="#8-3-动态库的版本号"><span class="level-left"><span class="level-item">8.3</span><span class="level-item">8.3 动态库的版本号</span></span></a></li><li><a class="level is-mobile" href="#8-4-安装共享库和头文件"><span class="level-left"><span class="level-item">8.4</span><span class="level-item">8.4 安装共享库和头文件</span></span></a></li><li><a class="level is-mobile" href="#8-5-解决：make后头文件找不到的问题"><span class="level-left"><span class="level-item">8.5</span><span class="level-item">8.5 解决：make后头文件找不到的问题</span></span></a></li><li><a class="level is-mobile" href="#8-6-解决：找到引用的函数问题"><span class="level-left"><span class="level-item">8.6</span><span class="level-item">8.6 解决：找到引用的函数问题</span></span></a></li><li><a class="level is-mobile" href="#8-7-特殊的环境变量-CMAKE-INCLUDE-PATH-和-CMAKE-LIBRARY-PATH"><span class="level-left"><span class="level-item">8.7</span><span class="level-item">8.7 特殊的环境变量 CMAKE_INCLUDE_PATH 和 CMAKE_LIBRARY_PATH</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/C/"><span class="level-start"><span class="level-item">C++</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/C-Tools/"><span class="level-start"><span class="level-item">C++ Tools</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">并发编程</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="level-start"><span class="level-item">数据库</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"><span class="level-start"><span class="level-item">数据结构与算法</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"><span class="level-start"><span class="level-item">服务器</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%9D%82%E9%A1%B9/"><span class="level-start"><span class="level-item">杂项</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"><span class="level-start"><span class="level-item">计算机网络</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-25T06:36:41.000Z">2023-04-25</time></p><p class="title"><a href="/2023/04/25/%E7%BC%96%E8%AF%91%E4%B8%8E%E7%BC%96%E8%AF%91%E5%99%A8/">编译与编译器</a></p><p class="categories"><a href="/categories/%E6%9D%82%E9%A1%B9/">杂项</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-24T06:20:01.000Z">2023-04-24</time></p><p class="title"><a href="/2023/04/24/CMake%E5%AD%A6%E4%B9%A0/">CMake学习</a></p><p class="categories"><a href="/categories/C-Tools/">C++ Tools</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-22T13:23:33.000Z">2023-04-22</time></p><p class="title"><a href="/2023/04/22/myMuduo%E5%9B%9E%E9%A1%BE%E4%BA%8C%EF%BC%9A%E5%85%B6%E4%BB%96%E9%83%A8%E5%88%86/">myMuduo回顾二：其他部分</a></p><p class="categories"><a href="/categories/C/">C++</a> / <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-22T13:15:01.000Z">2023-04-22</time></p><p class="title"><a href="/2023/04/22/myMuduo%E5%9B%9E%E9%A1%BE%E4%B8%80%EF%BC%9A%E7%BB%84%E4%BB%B6%E4%B8%8E%E6%95%B4%E4%BD%93%E9%80%BB%E8%BE%91/">myMuduo回顾一：组件与整体逻辑</a></p><p class="categories"><a href="/categories/C/">C++</a> / <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-18T11:58:03.000Z">2023-04-18</time></p><p class="title"><a href="/2023/04/18/%E6%97%A0%E9%94%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%88-C/">无锁数据结构-栈(C++)</a></p><p class="categories"><a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a> / <a href="/categories/C/">C++</a> / <a href="/categories/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">并发编程</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">MK&#039;s Blog</a><p class="is-size-7"><span>&copy; 2023 MK</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>